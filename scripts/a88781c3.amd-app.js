var requirejs,require,define;(function(global){function isFunction(a){return ostring.call(a)==="[object Function]"}function isArray(a){return ostring.call(a)==="[object Array]"}function each(a,b){if(a){var c;for(c=0;c<a.length;c+=1)if(a[c]&&b(a[c],c,a))break}}function eachReverse(a,b){if(a){var c;for(c=a.length-1;c>-1;c-=1)if(a[c]&&b(a[c],c,a))break}}function hasProp(a,b){return hasOwn.call(a,b)}function eachProp(a,b){var c;for(c in a)if(a.hasOwnProperty(c)&&b(a[c],c))break}function mixin(a,b,c,d){return b&&eachProp(b,function(b,e){if(c||!hasProp(a,e))d&&typeof b!="string"?(a[e]||(a[e]={}),mixin(a[e],b,c,d)):a[e]=b}),a}function bind(a,b){return function(){return b.apply(a,arguments)}}function scripts(){return document.getElementsByTagName("script")}function getGlobal(a){if(!a)return a;var b=global;return each(a.split("."),function(a){b=b[a]}),b}function makeContextModuleFunc(a,b,c){return function(){var d=aps.call(arguments,0),e;return c&&isFunction(e=d[d.length-1])&&(e.__requireJsBuild=!0),d.push(b),a.apply(null,d)}}function addRequireMethods(a,b,c){each([["toUrl"],["undef"],["defined","requireDefined"],["specified","requireSpecified"]],function(d){var e=d[1]||d[0];a[d[0]]=b?makeContextModuleFunc(b[e],c):function(){var a=contexts[defContextName];return a[e].apply(a,arguments)}})}function makeError(a,b,c,d){var e=new Error(b+"\nhttp://requirejs.org/docs/errors.html#"+a);return e.requireType=a,e.requireModules=d,c&&(e.originalError=c),e}function newContext(a){function p(a){var b,c;for(b=0;a[b];b+=1){c=a[b];if(c===".")a.splice(b,1),b-=1;else if(c===".."){if(b===1&&(a[2]===".."||a[0]===".."))break;b>0&&(a.splice(b-1,2),b-=2)}}}function q(a,b,c){var d,e,f,h,i,j,k,l,m,n,o,q=b&&b.split("/"),r=q,s=g.map,t=s&&s["*"];a&&a.charAt(0)==="."&&(b?(g.pkgs[b]?r=q=[b]:r=q.slice(0,q.length-1),a=r.concat(a.split("/")),p(a),e=g.pkgs[d=a[0]],a=a.join("/"),e&&a===d+"/"+e.main&&(a=d)):a.indexOf("./")===0&&(a=a.substring(2)));if(c&&(q||t)&&s){h=a.split("/");for(i=h.length;i>0;i-=1){k=h.slice(0,i).join("/");if(q)for(j=q.length;j>0;j-=1){f=s[q.slice(0,j).join("/")];if(f){f=f[k];if(f){l=f,m=i;break}}}if(l)break;!n&&t&&t[k]&&(n=t[k],o=i)}!l&&n&&(l=n,m=o),l&&(h.splice(0,m,l),a=h.join("/"))}return a}function r(a){isBrowser&&each(scripts(),function(b){if(b.getAttribute("data-requiremodule")===a&&b.getAttribute("data-requirecontext")===d.contextName)return b.parentNode.removeChild(b),!0})}function s(a){var b=g.paths[a];if(b&&isArray(b)&&b.length>1)return r(a),b.shift(),d.undef(a),d.require([a]),!0}function t(a,b,c,e){var f,g,h,i=a?a.indexOf("!"):-1,j=null,l=b?b.name:null,o=a,p=!0,r="";return a||(p=!1,a="_@r"+(m+=1)),i!==-1&&(j=a.substring(0,i),a=a.substring(i+1,a.length)),j&&(j=q(j,l,e),g=k[j]),a&&(j?g&&g.normalize?r=g.normalize(a,function(a){return q(a,l,e)}):r=q(a,l,e):(r=q(a,l,e),f=d.nameToUrl(r))),h=j&&!g&&!c?"_unnormalized"+(n+=1):"",{prefix:j,name:r,parentMap:b,unnormalized:!!h,url:f,originalName:o,isDefine:p,id:(j?j+"!"+r:r)+h}}function u(a){var b=a.id,c=h[b];return c||(c=h[b]=new d.Module(a)),c}function v(a,b,c){var d=a.id,e=h[d];hasProp(k,d)&&(!e||e.defineEmitComplete)?b==="defined"&&c(k[d]):u(a).on(b,c)}function w(a,b){var c=a.requireModules,d=!1;b?b(a):(each(c,function(b){var c=h[b];c&&(c.error=a,c.events.error&&(d=!0,c.emit("error",a)))}),d||req.onError(a))}function x(){globalDefQueue.length&&(apsp.apply(j,[j.length-1,0].concat(globalDefQueue)),globalDefQueue=[])}function y(a,b,c){var e=a&&a.map,f=makeContextModuleFunc(c||d.require,e,b);return addRequireMethods(f,d,e),f.isBrowser=isBrowser,f}function z(a){delete h[a],each(o,function(b,c){if(b.map.id===a)return o.splice(c,1),b.defined||(d.waitCount-=1),!0})}function A(a,b){var c=a.map.id,d=a.depMaps,e;if(!a.inited)return;return b[c]?a:(b[c]=!0,each(d,function(a){var d=a.id,f=h[d];if(!f)return;return!f.inited||!f.enabled?(e=null,delete b[c],!0):e=A(f,mixin({},b))}),e)}function B(a,b,c){var d=a.map.id,f=a.depMaps;if(!a.inited||!a.map.isDefine)return;return b[d]?k[d]:(b[d]=a,each(f,function(f){var g=f.id,i=h[g],j;if(e[g])return;if(i){if(!i.inited||!i.enabled){c[d]=!0;return}j=B(i,b,c),c[g]||a.defineDepById(g,j)}}),a.check(!0),k[d])}function C(a){a.check()}function D(){var a,c,e,i,j=g.waitSeconds*1e3,k=j&&d.startTime+j<(new Date).getTime(),l=[],m=!1,n=!0;if(b)return;b=!0,eachProp(h,function(b){a=b.map,c=a.id;if(!b.enabled)return;if(!b.error)if(!b.inited&&k)s(c)?(i=!0,m=!0):(l.push(c),r(c));else if(!b.inited&&b.fetched&&a.isDefine){m=!0;if(!a.prefix)return n=!1}});if(k&&l.length)return e=makeError("timeout","Load timeout for modules: "+l,null,l),e.contextName=d.contextName,w(e);n&&(each(o,function(a){if(a.defined)return;var b=A(a,{}),c={};b&&(B(b,c,{}),eachProp(c,C))}),eachProp(h,C)),(!k||i)&&m&&(isBrowser||isWebWorker)&&!f&&(f=setTimeout(function(){f=0,D()},50)),b=!1}function E(a){u(t(a[0],null,!0)).init(a[1],a[2])}function F(a,b,c,d){a.detachEvent&&!isOpera?d&&a.detachEvent(d,b):a.removeEventListener(c,b,!1)}function G(a){var b=a.currentTarget||a.srcElement;return F(b,d.onScriptLoad,"load","onreadystatechange"),F(b,d.onScriptError,"error"),{node:b,id:b&&b.getAttribute("data-requiremodule")}}var b,c,d,e,f,g={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{}},h={},i={},j=[],k={},l={},m=1,n=1,o=[];return e={require:function(a){return y(a)},exports:function(a){a.usingExports=!0;if(a.map.isDefine)return a.exports=k[a.map.id]={}},module:function(a){return a.module={id:a.map.id,uri:a.map.url,config:function(){return g.config&&g.config[a.map.id]||{}},exports:k[a.map.id]}}},c=function(a){this.events=i[a.id]||{},this.map=a,this.shim=g.shim[a.id],this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},c.prototype={init:function(a,b,c,d){d=d||{};if(this.inited)return;this.factory=b,c?this.on("error",c):this.events.error&&(c=bind(this,function(a){this.emit("error",a)})),this.depMaps=a&&a.slice(0),this.depMaps.rjsSkipMap=a.rjsSkipMap,this.errback=c,this.inited=!0,this.ignore=d.ignore,d.enabled||this.enabled?this.enable():this.check()},defineDepById:function(a,b){var c;return each(this.depMaps,function(b,d){if(b.id===a)return c=d,!0}),this.defineDep(c,b)},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(this.fetched)return;this.fetched=!0,d.startTime=(new Date).getTime();var a=this.map;if(!this.shim)return a.prefix?this.callPlugin():this.load();y(this,!0)(this.shim.deps||[],bind(this,function(){return a.prefix?this.callPlugin():this.load()}))},load:function(){var a=this.map.url;l[a]||(l[a]=!0,d.load(this.map.id,a))},check:function(a){if(!this.enabled||this.enabling)return;var b,c,e=this.map.id,f=this.depExports,g=this.exports,i=this.factory;if(!this.inited)this.fetch();else if(this.error)this.emit("error",this.error);else if(!this.defining){this.defining=!0;if(this.depCount<1&&!this.defined){if(isFunction(i)){if(this.events.error)try{g=d.execCb(e,i,f,g)}catch(j){b=j}else g=d.execCb(e,i,f,g);this.map.isDefine&&(c=this.module,c&&c.exports!==undefined&&c.exports!==this.exports?g=c.exports:g===undefined&&this.usingExports&&(g=this.exports));if(b)return b.requireMap=this.map,b.requireModules=[this.map.id],b.requireType="define",w(this.error=b)}else g=i;this.exports=g,this.map.isDefine&&!this.ignore&&(k[e]=g,req.onResourceLoad&&req.onResourceLoad(d,this.map,this.depMaps)),delete h[e],this.defined=!0,d.waitCount-=1,d.waitCount===0&&(o=[])}this.defining=!1,a||this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}},callPlugin:function(){var a=this.map,b=a.id,c=t(a.prefix,null,!1,!0);v(c,"defined",bind(this,function(c){var e,f,i,j=this.map.name,k=this.map.parentMap?this.map.parentMap.name:null;if(this.map.unnormalized){c.normalize&&(j=c.normalize(j,function(a){return q(a,k,!0)})||""),f=t(a.prefix+"!"+j,this.map.parentMap,!1,!0),v(f,"defined",bind(this,function(a){this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),i=h[f.id],i&&(this.events.error&&i.on("error",bind(this,function(a){this.emit("error",a)})),i.enable());return}e=bind(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),e.error=bind(this,function(a){this.inited=!0,this.error=a,a.requireModules=[b],eachProp(h,function(a){a.map.id.indexOf(b+"_unnormalized")===0&&z(a.map.id)}),w(a)}),e.fromText=function(a,b){var c=useInteractive;c&&(useInteractive=!1),u(t(a)),req.exec(b),c&&(useInteractive=!0),d.completeLoad(a)},c.load(a.name,y(a.parentMap,!0,function(a,b,c){return a.rjsSkipMap=!0,d.require(a,b,c)}),e,g)})),d.enable(c,this),this.pluginMaps[c.id]=c},enable:function(){this.enabled=!0,this.waitPushed||(o.push(this),d.waitCount+=1,this.waitPushed=!0),this.enabling=!0,each(this.depMaps,bind(this,function(a,b){var c,f,g;if(typeof a=="string"){a=t(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.depMaps.rjsSkipMap),this.depMaps[b]=a,g=e[a.id];if(g){this.depExports[b]=g(this);return}this.depCount+=1,v(a,"defined",bind(this,function(a){this.defineDep(b,a),this.check()})),this.errback&&v(a,"error",this.errback)}c=a.id,f=h[c],!e[c]&&f&&!f.enabled&&d.enable(a,this)})),eachProp(this.pluginMaps,bind(this,function(a){var b=h[a.id];b&&!b.enabled&&d.enable(a,this)})),this.enabling=!1,this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]),c.push(b)},emit:function(a,b){each(this.events[a],function(a){a(b)}),a==="error"&&delete this.events[a]}},d={config:g,contextName:a,registry:h,defined:k,urlFetched:l,waitCount:0,defQueue:j,Module:c,makeModuleMap:t,configure:function(a){a.baseUrl&&a.baseUrl.charAt(a.baseUrl.length-1)!=="/"&&(a.baseUrl+="/");var b=g.pkgs,c=g.shim,e=g.paths,f=g.map;mixin(g,a,!0),g.paths=mixin(e,a.paths,!0),a.map&&(g.map=mixin(f||{},a.map,!0,!0)),a.shim&&(eachProp(a.shim,function(a,b){isArray(a)&&(a={deps:a}),a.exports&&!a.exports.__buildReady&&(a.exports=d.makeShimExports(a.exports)),c[b]=a}),g.shim=c),a.packages&&(each(a.packages,function(a){var c;a=typeof a=="string"?{name:a}:a,c=a.location,b[a.name]={name:a.name,location:c||a.name,main:(a.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}}),g.pkgs=b),eachProp(h,function(a,b){!a.inited&&!a.map.unnormalized&&(a.map=t(b))}),(a.deps||a.callback)&&d.require(a.deps||[],a.callback)},makeShimExports:function(a){var b;return typeof a=="string"?(b=function(){return getGlobal(a)},b.exports=a,b):function(){return a.apply(global,arguments)}},requireDefined:function(a,b){return hasProp(k,t(a,b,!1,!0).id)},requireSpecified:function(a,b){return a=t(a,b,!1,!0).id,hasProp(k,a)||hasProp(h,a)},require:function(b,c,e,f){var g,h,i,l,m;if(typeof b=="string")return isFunction(c)?w(makeError("requireargs","Invalid require call"),e):req.get?req.get(d,b,c):(g=b,f=c,i=t(g,f,!1,!0),h=i.id,hasProp(k,h)?k[h]:w(makeError("notloaded",'Module name "'+h+'" has not been loaded yet for context: '+a)));e&&!isFunction(e)&&(f=e,e=undefined),c&&!isFunction(c)&&(f=c,c=undefined),x();while(j.length){m=j.shift();if(m[0]===null)return w(makeError("mismatch","Mismatched anonymous define() module: "+m[m.length-1]));E(m)}return l=u(t(null,f)),l.init(b,c,e,{enabled:!0}),D(),d.require},undef:function(a){x();var b=t(a,null,!0),c=h[a];delete k[a],delete l[b.url],delete i[a],c&&(c.events.defined&&(i[a]=c.events),z(a))},enable:function(a,b){var c=h[a.id];c&&u(a).enable()},completeLoad:function(a){var b,c,d,e=g.shim[a]||{},f=e.exports&&e.exports.exports;x();while(j.length){c=j.shift();if(c[0]===null){c[0]=a;if(b)break;b=!0}else c[0]===a&&(b=!0);E(c)}d=h[a];if(!b&&!k[a]&&d&&!d.inited){if(g.enforceDefine&&(!f||!getGlobal(f))){if(s(a))return;return w(makeError("nodefine","No define call for "+a,null,[a]))}E([a,e.deps||[],e.exports])}D()},toUrl:function(a,b){var c=a.lastIndexOf("."),e=null;return c!==-1&&(e=a.substring(c,a.length),a=a.substring(0,c)),d.nameToUrl(q(a,b&&b.id,!0),e)},nameToUrl:function(a,b){var c,d,e,f,h,i,j,k,l;if(req.jsExtRegExp.test(a))k=a+(b||"");else{c=g.paths,d=g.pkgs,h=a.split("/");for(i=h.length;i>0;i-=1){j=h.slice(0,i).join("/"),e=d[j],l=c[j];if(l){isArray(l)&&(l=l[0]),h.splice(0,i,l);break}if(e){a===e.name?f=e.location+"/"+e.main:f=e.location,h.splice(0,i,f);break}}k=h.join("/"),k+=b||(/\?/.test(k)?"":".js"),k=(k.charAt(0)==="/"||k.match(/^[\w\+\.\-]+:/)?"":g.baseUrl)+k}return g.urlArgs?k+((k.indexOf("?")===-1?"?":"&")+g.urlArgs):k},load:function(a,b){req.load(d,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if(a.type==="load"||readyRegExp.test((a.currentTarget||a.srcElement).readyState)){interactiveScript=null;var b=G(a);d.completeLoad(b.id)}},onScriptError:function(a){var b=G(a);if(!s(b.id))return w(makeError("scripterror","Script error",a,[b.id]))}}}function getInteractiveScript(){return interactiveScript&&interactiveScript.readyState==="interactive"?interactiveScript:(eachReverse(scripts(),function(a){if(a.readyState==="interactive")return interactiveScript=a}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.0.5",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,aps=ap.slice,apsp=ap.splice,isBrowser=typeof window!="undefined"&&!!navigator&&!!document,isWebWorker=!isBrowser&&typeof importScripts!="undefined",readyRegExp=isBrowser&&navigator.platform==="PLAYSTATION 3"?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera=typeof opera!="undefined"&&opera.toString()==="[object Opera]",contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if(typeof define!="undefined")return;if(typeof requirejs!="undefined"){if(isFunction(requirejs))return;cfg=requirejs,requirejs=undefined}typeof require!="undefined"&&!isFunction(require)&&(cfg=require,require=undefined),req=requirejs=function(a,b,c,d){var e,f,g=defContextName;return!isArray(a)&&typeof a!="string"&&(f=a,isArray(b)?(a=b,b=c,c=d):a=[]),f&&f.context&&(g=f.context),e=contexts[g],e||(e=contexts[g]=req.s.newContext(g)),f&&e.configure(f),e.require(a,b,c)},req.config=function(a){return req(a)},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),addRequireMethods(req),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=function(a){throw a},req.load=function(a,b,c){var d=a&&a.config||{},e;if(isBrowser)return e=d.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script"),e.type=d.scriptType||"text/javascript",e.charset="utf-8",e.async=!0,e.setAttribute("data-requirecontext",a.contextName),e.setAttribute("data-requiremodule",b),e.attachEvent&&!(e.attachEvent.toString&&e.attachEvent.toString().indexOf("[native code")<0)&&!isOpera?(useInteractive=!0,e.attachEvent("onreadystatechange",a.onScriptLoad)):(e.addEventListener("load",a.onScriptLoad,!1),e.addEventListener("error",a.onScriptError,!1)),e.src=c,currentlyAddingScript=e,baseElement?head.insertBefore(e,baseElement):head.appendChild(e),currentlyAddingScript=null,e;isWebWorker&&(importScripts(c),a.completeLoad(b))},isBrowser&&eachReverse(scripts(),function(a){head||(head=a.parentNode),dataMain=a.getAttribute("data-main");if(dataMain)return cfg.baseUrl||(src=dataMain.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath,dataMain=mainScript),dataMain=dataMain.replace(jsSuffixRegExp,""),cfg.deps=cfg.deps?cfg.deps.concat(dataMain):[dataMain],!0}),define=function(a,b,c){var d,e;typeof a!="string"&&(c=b,b=a,a=null),isArray(b)||(c=b,b=[]),!b.length&&isFunction(c)&&c.length&&(c.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(a,c){b.push(c)}),b=(c.length===1?["require"]:["require","exports","module"]).concat(b)),useInteractive&&(d=currentlyAddingScript||getInteractiveScript(),d&&(a||(a=d.getAttribute("data-requiremodule")),e=contexts[d.getAttribute("data-requirecontext")])),(e?e.defQueue:globalDefQueue).push([a,b,c])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)})(this),function(){var a=function(){console.log("node images loaded");if(typeof a=="undefined")var a={};return typeof a.Images=="undefined"&&(a.Images={}),a.Images.player1={},a.Images.player2={},a.Images.platform={},a.Images.spawn={},a.Images.powerup={},a.Images.ropeAnchor={},a.Images.mallow={},a.Images.mallowFiller={},a.Images.pickups={},a.Images},b=function(){console.log("browser images loaded");if(typeof a=="undefined")var a={};return typeof a.Images=="undefined"&&(a.Images={}),a.Images.player1=document.getElementById("playerSprite1"),a.Images.player2=document.getElementById("playerSprite2"),a.Images.platform=document.getElementById("main_platform"),a.Images.spawn=document.getElementById("spawn_platform"),a.Images.powerup=document.getElementById("powerup_spawn"),a.Images.ropeAnchor=document.getElementById("rope_anchor"),a.Images.mallow=document.getElementById("marshmallowSprites"),a.Images.mallowFiller=document.getElementById("mallow"),a.Images.pickups=document.getElementById("pickupSprites"),a.Images};console.log("loading images"),typeof define!="undefined"?define("mduel/images",[],b):typeof module!="undefined"&&(module.exports=a());var c=function(){console.log("spriteSheet loaded");if(typeof a=="undefined")var a={};return typeof a.Spritesheet=="undefined"&&(a.Spritesheet={}),a.Spritesheet.spritesheet=function(a){var b={};return b.sprites=a.sprites,b.width=a.width,b.height=a.height,b.getOffset=function(a){var c=b.sprites[a];return c?{x:c.x||0,y:(c.y||0)*b.height,width:b.width,height:b.height}:null},b},a.Spritesheet};typeof define!="undefined"?define("mduel/spritesheet",[],c):typeof module!="undefined"&&(module.exports=c());var d=function(a){console.log("sprites loaded");if(typeof b=="undefined")var b={};return typeof b.Sprites=="undefined"&&(b.Sprites={}),b.Spritesheet=a,b.Sprites.player=b.Spritesheet.spritesheet({width:64,height:64,sprites:{stand:{x:0,y:0},run_1:{x:0,y:1},run_2:{x:0,y:2},run_3:{x:0,y:3},run_4:{x:0,y:4},crouched:{x:0,y:5},crouching:{x:0,y:6},roll_1:{x:0,y:7},roll_2:{x:0,y:8},roll_3:{x:0,y:9},roll_4:{x:0,y:10},jump_1:{x:0,y:11},jump_2:{x:0,y:12},jump_3:{x:0,y:13},jump_4:{x:0,y:14},jump_5:{x:0,y:15},jump_6:{x:0,y:16},jump_7:{x:0,y:17},run_jump_1:{x:0,y:18},run_jump_2:{x:0,y:19},run_jump_3:{x:0,y:20},stand_fall:{x:0,y:21},roll_back_1:{x:0,y:22},roll_back_2:{x:0,y:23},roll_back_3:{x:0,y:24},roll_back_4:{x:0,y:25},knock_forward_1:{x:0,y:26},knock_forward_2:{x:0,y:27},knock_back_1:{x:0,y:28},knock_back_2:{x:0,y:29},gun_shoot_1:{x:0,y:30},gun_shoot_2:{x:0,y:31},grenade_toss_1:{x:0,y:32},grenade_toss_2:{x:0,y:33},puck_toss_1:{x:0,y:34},puck_toss_2:{x:0,y:35},parachute:{x:0,y:36},unknown_27:{x:0,y:37},unknown_28:{x:0,y:38},climb_1:{x:0,y:39},climb_2:{x:0,y:40},climb_3:{x:0,y:41},climb_4:{x:0,y:42},climb_5:{x:0,y:43},stand_victory_1:{x:0,y:44},stand_victory_2:{x:0,y:45},rope_victory_1:{x:0,y:46},rope_victory_2:{x:0,y:47},disintegrate_1:{x:0,y:48},disintegrate_2:{x:0,y:49},disintegrate_3:{x:0,y:50},disintegrate_4:{x:0,y:51},disintegrate_5:{x:0,y:52},disintegrate_6:{x:0,y:53},vaporize_1:{x:0,y:54},vaporize_2:{x:0,y:55},vaporize_3:{x:0,y:56},vaporize_4:{x:0,y:57},taunt_1:{x:0,y:58},taunt_2:{x:0,y:59},taunt_3:{x:0,y:60},taunt_4:{x:0,y:61},flex_1:{x:0,y:62},flex_2:{x:0,y:63},magnet_1:{x:0,y:64},magnet_2:{x:0,y:65},empty:{x:0,y:66},trapped:{x:0,y:67}}}),b.Sprites.pit=b.Spritesheet.spritesheet({width:32,height:32,sprites:{pit0:{x:0,y:0},pit1:{x:0,y:1},pit2:{x:0,y:2},pit3:{x:0,y:3}}}),b.Sprites.pickups=b.Spritesheet.spritesheet({width:32,height:32,sprites:{bubble1:{x:0,y:0},bubble2:{x:0,y:1},bubble3:{x:0,y:2},skull:{x:0,y:3},lightning:{x:0,y:4},invisibility:{x:0,y:5},mine:{x:0,y:6},gun:{x:0,y:7},explode:{x:0,y:8},boot:{x:0,y:9},grenade:{x:0,y:10},puck:{x:0,y:11},parachute:{x:0,y:12},unknown_1:{x:0,y:13},unknown_2:{x:0,y:14},magnet:{x:0,y:15},unknown_3:{x:0,y:16},shield:{x:0,y:17},drop:{x:0,y:18},unknown_4:{x:0,y:19},corner_tl:{x:0,y:20},corner_tr:{x:0,y:21},corner_br:{x:0,y:22},puck_1:{x:0,y:23},puck_2:{x:0,y:24},grenade_1:{x:0,y:25},grenade_2:{x:0,y:26},bigdrop:{x:0,y:27}}}),b.Sprites};typeof define!="undefined"?define("mduel/sprites",["mduel/spritesheet"],d):typeof module!="undefined"&&(module.exports=d(require("./spritesheet")));var e=function(a){console.log("animation loaded");if(typeof b=="undefined")var b={};return typeof b.Animation=="undefined"&&(b.Animation={}),b.Sprites=a,b.Animation.animation=function(a){var b={};return b.frames=a.frames,b.sprites=a.data,b.loop=a.loop,b.finished=!1,b.frameDuration=a.frames[0].time,b.frameIndex=a.startFrame||0,b.animate=function(a){b.frameDuration-=a,b.frameDuration<=0&&!b.finished&&(b.frameIndex++,b.frameIndex==b.frames.length&&(b.loop?b.frameIndex=0:(b.finished=!0,b.frameIndex=b.frames.length-1)),b.frameDuration=b.frames[b.frameIndex].time)},b.isFinished=function(){return b.finished},b.getSprite=function(){return b.sprites.getOffset(b.frames[b.frameIndex].sprite)},b},b.Animation};typeof define!="undefined"?define("mduel/animation",["mduel/sprites"],e):typeof module!="undefined"&&(module.exports=e(require("./sprites")));var f=function(a,b){console.log("animations loaded");if(typeof c=="undefined")var c={};return typeof c.Animations=="undefined"&&(c.Animations={}),c.Sprites=a,c.Animation=b,c.Animations.pit=function(a){return c.Animation.animation({frames:[{sprite:"pit0",time:2500},{sprite:"pit1",time:2500},{sprite:"pit2",time:2500},{sprite:"pit3",time:2500}],data:c.Sprites.pit,loop:!0,startFrame:a})},c.Animations.bubble=function(){return c.Animation.animation({frames:[{sprite:"bubble1",time:250},{sprite:"bubble2",time:250},{sprite:"bubble3",time:250}],data:c.Sprites.pickups,loop:!0})},c.Animations.skull=function(){return c.Animation.animation({frames:[{sprite:"skull",time:1e7}],data:c.Sprites.pickups})},c.Animations.lightning=function(){return c.Animation.animation({frames:[{sprite:"lightning",time:1e7}],data:c.Sprites.pickups})},c.Animations.invisibility=function(){return c.Animation.animation({frames:[{sprite:"invisibility",time:1e7}],data:c.Sprites.pickups})},c.Animations.mine=function(){return c.Animation.animation({frames:[{sprite:"mine",time:1e7}],data:c.Sprites.pickups})},c.Animations.gun=function(){return c.Animation.animation({frames:[{sprite:"gun",time:1e7}],data:c.Sprites.pickups})},c.Animations.explode=function(){return c.Animation.animation({frames:[{sprite:"explode",time:1e7}],data:c.Sprites.pickups})},c.Animations.knockForward=function(){return c.Animation.animation({frames:[{sprite:"knock_forward_1",time:15},{sprite:"knock_forward_2",time:15}],data:c.Sprites.player})},c.Animations.knockBack=function(){return c.Animation.animation({frames:[{sprite:"knock_back_1",time:15},{sprite:"knock_back_2",time:15}],data:c.Sprites.player})},c.Animations.disintegrate=function(){return c.Animation.animation({frames:[{sprite:"disintegrate_1",time:75},{sprite:"disintegrate_2",time:75},{sprite:"disintegrate_3",time:75},{sprite:"disintegrate_4",time:75},{sprite:"disintegrate_5",time:75},{sprite:"disintegrate_6",time:75}],data:c.Sprites.player})},c.Animations.stand=function(){return c.Animation.animation({frames:[{sprite:"stand",time:1e7}],data:c.Sprites.player})},c.Animations.run=function(){return c.Animation.animation({frames:[{sprite:"run_1",time:75},{sprite:"run_2",time:75},{sprite:"run_3",time:75},{sprite:"run_4",time:75}],loop:!0,data:c.Sprites.player})},c.Animations.roll=function(){return c.Animation.animation({frames:[{sprite:"crouching",time:75},{sprite:"roll_1",time:75},{sprite:"roll_2",time:75},{sprite:"roll_3",time:75},{sprite:"roll_4",time:75},{sprite:"crouched",time:1}],data:c.Sprites.player})},c.Animations.crouching=function(){return c.Animation.animation({frames:[{sprite:"crouching",time:75},{sprite:"crouched",time:1}],data:c.Sprites.player})},c.Animations.crouch=function(){return c.Animation.animation({frames:[{sprite:"crouched",time:1}],data:c.Sprites.player})},c.Animations.uncrouching=function(){return c.Animation.animation({frames:[{sprite:"crouched",time:75},{sprite:"crouching",time:1}],data:c.Sprites.player})},c.Animations.standJump=function(){return c.Animation.animation({frames:[{sprite:"jump_2",time:75},{sprite:"jump_3",time:75},{sprite:"jump_4",time:75},{sprite:"jump_5",time:75},{sprite:"jump_6",time:75},{sprite:"jump_7",time:75}],data:c.Sprites.player})},c.Animations.runJump=function(){return c.Animation.animation({frames:[{sprite:"run_jump_1",time:150},{sprite:"run_jump_2",time:150},{sprite:"run_jump_3",time:150}],data:c.Sprites.player})},c.Animations.climbing=function(){return c.Animation.animation({frames:[{sprite:"climb_1",time:75},{sprite:"climb_2",time:75},{sprite:"climb_3",time:75},{sprite:"climb_4",time:75}],loop:!0,data:c.Sprites.player})},c.Animations.rope=function(){return c.Animation.animation({frames:[{sprite:"climb_5",time:1}],data:c.Sprites.player})},c.Animations.standFall=function(){return c.Animation.animation({frames:[{sprite:"stand_fall",time:1}],data:c.Sprites.player})},c.Animations.empty=function(){return c.Animation.animation({frames:[{sprite:"empty",time:1}],data:c.Sprites.player})},c.Animations};typeof define!="undefined"?define("mduel/animations",["mduel/sprites","mduel/animation"],f):typeof module!="undefined"&&(module.exports=f(require("./sprites"),require("./animation")));var g=function(){console.log("util loaded");if(typeof a=="undefined")var a={};return typeof a.Util=="undefined"&&(a.Util={}),a.Util.sum=function(a,b){var c=0;for(var d=0,e=a.length;d<e;d++)c+=b(a[d]);return c},a.Util.where=function(a,b){var c=new Array;for(var d=0,e=a.length;d<e;d++)b(a[d])&&c.push(a[d]);return c},a.Util.colliding=function(a,b){return a.x<b.x+b.width&&a.x+a.width>b.x&&a.y<b.y+b.height&&a.y+a.height>b.y},a.Util.removeAt=function(a,b){return a.splice(b,1),a},a.Util};typeof define!="undefined"?define("mduel/util",[],g):typeof module!="undefined"&&(module.exports=g());var h=function(a,b,c,d,e,f,g){function h(a){var b,d,e=this,f=a.length,g=0,h=e.i=e.j=e.m=0;e.S=[],e.c=[],f||(a=[f++]);while(g<c)e.S[g]=g++;for(g=0;g<c;g++)b=e.S[g],h=k(h+b+a[g%f]),d=e.S[h],e.S[g]=d,e.S[h]=b;e.g=function(b){var d=e.S,f=k(e.i+1),g=d[f],h=k(e.j+g),i=d[h];d[f]=i,d[h]=g;var j=d[k(g+i)];while(--b)f=k(f+1),g=d[f],h=k(h+g),i=d[h],d[f]=i,d[h]=g,j=j*c+d[k(g+i)];return e.i=f,e.j=h,j},e.g(c)}function i(a,b,c,d,e){c=[],e=typeof a;if(b&&e=="object")for(d in a)if(d.indexOf("S")<5)try{c.push(i(a[d],b-1))}catch(f){}return c.length?c:a+(e!="string"?"\0":"")}function j(a,b,c,d){a+="",c=0;for(d=0;d<a.length;d++)b[k(d)]=k((c^=b[k(d)]*19)+a.charCodeAt(d));a="";for(d in b)a+=String.fromCharCode(b[d]);return a}function k(a){return a&c-1}b.seedrandom=function(l,m){var n=[],o;return l=j(i(m?[l,a]:arguments.length?l:[(new Date).getTime(),a,window],3),n),o=new h(n),j(o.S,a),b.random=function(){var b=o.g(d),h=g,i=0;while(b<e)b=(b+i)*c,h*=c,i=o.g(1);while(b>=f)b/=2,h/=2,i>>>=1;return(b+i)/h},l},g=b.pow(c,d),e=b.pow(2,e),f=e*2,j(b.random(),a)};if(typeof define!="undefined")define("vendor/seedrandom",[],function(){var a={pow:Math.pow,random:Math.random};return h([],a,256,6,52),a});else if(typeof module!="undefined"){var i={pow:Math.pow,random:Math.random};h([],i,256,6,52),module.exports=i}else typeof window!="undefined"&&h([],Math,256,6,52);var j=function(a,b,c,d){d.seedrandom("the dark lords");var e=d.random;console.log("stage loaded");if(typeof f=="undefined")var f={};return typeof f.Stage=="undefined"&&(f.Stage={}),f.Images=a,f.Animations=b,f.Util=c,f.Stage.stage=function(a){var b={},c=f.Stage.generateStage();return b.platforms=c.platforms,b.ropes=c.ropes,b.pit=[f.Animations.pit(0),f.Animations.pit(1),f.Animations.pit(2),f.Animations.pit(3)],b.update=function(a){},b.draw=function(a,c,d,e){a.save(),a.translate(d,e/2-f.Images.platform.width/2),a.rotate(90*(Math.PI/180)),a.drawImage(f.Images.powerup,0,0),a.restore(),a.save(),a.translate(0,208),a.rotate(270*(Math.PI/180)),a.drawImage(f.Images.powerup,0,0),a.restore(),a.drawImage(f.Images.powerup,d/2-f.Images.platform.width/2,0);for(var g=0,h=b.platforms.length;g<h;g++){var i=b.platforms[g].isSpawn?f.Images.spawn:f.Images.platform;a.drawImage(i,b.platforms[g].x,b.platforms[g].y)}for(var g=0,h=b.ropes.length;g<h;g++){var j=b.ropes[g];a.drawImage(f.Images.ropeAnchor,j.anchor.x,j.anchor.y),a.moveTo(j.ropeStart.x,j.ropeStart.y),a.lineTo(j.ropeEnd.x,j.ropeEnd.y)}a.strokeStyle="#926100",a.stroke();for(var g=0,h=b.pit.length;g<h;g++)b.pit[g].animate(c);for(var g=0,k=d;g<k;g+=32*b.pit.length)for(var l=0,h=b.pit.length;l<h;l++){var m=b.pit[l].getSprite();a.drawImage(f.Images.mallow,m.x,m.y,m.width,m.height,g+l*m.width,e-(m.height+22),m.width,m.height),a.drawImage(f.Images.mallowFiller,g+l*32,e-m.height)}},b},f.Stage.generateStage=function(){var a=[f.Stage.generateTopLevel(),f.Stage.generateLevel(18),f.Stage.generateLevel(18),f.Stage.generateLevel(18)],b=new Array,c=64,d=80;for(var e=0;e<a.length;e++){var g=a[e];for(var h=0;h<g.length;h++)g[h]&&b.push({x:h*32+32,y:e*c+d,isSpawn:!1})}for(var i=0;i<4;i++)b.push({x:32*i+48,y:4*c+d,isSpawn:!0});for(var i=0;i<4;i++)b.push({x:32*(i+13)+48,y:4*c+d,isSpawn:!0});var j=f.Stage.generateRopes(a,18);return{platforms:b,ropes:j}},f.Stage.generateTopLevel=function(){var a=new Array;return a[0]={width:2,isPlatform:!1},a[1]={width:4,isPlatform:!0},a[2]={width:6,isPlatform:!1},a[3]={width:4,isPlatform:!0},a[4]={width:2,isPlatform:!1},f.Stage.convertLevel(a)},f.Stage.generateLevel=function(a){var b=7,c=2,d=2,g=1,h=new Array,i=Math.floor(e()*2),j=function(a){return a.width};while(f.Util.sum(h,j)<a){var k=i?c:g,l=i?b:d,m=Math.floor(e()*(l+1-k))+k;h.push({width:m,isPlatform:i}),i=!i;var n=f.Util.sum(h,j);n>a&&(h[h.length-1].width-=n-a,h[h.length-1].isPlatform=!1)}return f.Stage.convertLevel(h)},f.Stage.convertLevel=function(a){var b=new Array;for(var c=0,d=a.length;c<d;c++)for(var e=0,f=a[c].width;e<f;e++)b.push(a[c].isPlatform);return b},f.Stage.generateRopes=function(a,b){var c=new Array;c.push({x:4,y:0,ropeLength:5}),c.push({x:14,y:0,ropeLength:5});var d=new Array,g=new Array;for(var h=1;h<b;h++){var i=new Array;a[1][h]&&a[2][h]&&i.push({x:h,y:1,ropeLength:2}),a[2][h]&&a[3][h]&&i.push({x:h,y:2,ropeLength:2}),a[1][h]&&a[3][h]&&i.push({x:h,y:1,ropeLength:3});if(i.length>0){var j=Math.floor(e()*i.length),k=i[j];h<4?d.push(k):h>4&&h!=14&&g.push(k)}}if(d.length>0){var j=Math.floor(e()*d.length);c.push(d[j])}if(g.length>0){var l=Math.min(g.length,Math.floor(e()*3)+1),m=0;while(m<l){var j=Math.floor(e()*g.length);c.push(g[j]),m++}}var n=26,o=new Array,p=f.Images.ropeAnchor.height,q=f.Images.ropeAnchor.width/2;for(var h=0,r=c.length;h<r;h++){var s=c[h],t=s.x==4||s.x==14?25:41;s.x=s.x*32+t,s.y=s.y*64+n,o.push({anchor:{x:s.x,y:s.y},ropeStart:{x:s.x+q,y:s.y+p},ropeEnd:{x:s.x+q,y:s.y+s.ropeLength*64-(f.Images.spawn.height+1)}})}return o},f.Stage};typeof define!="undefined"?define("mduel/stage",["mduel/images","mduel/animations","mduel/util","vendor/seedrandom"],j):typeof module!="undefined"&&(module.exports=j(require("./images"),require("./animations"),require("./util"),require("../vendor/seedrandom")));var k=function(){console.log("keyboard loaded");if(typeof a=="undefined")var a={};return typeof a.Keyboard=="undefined"&&(a.Keyboard={}),a.Keyboard.keyDown=function(b){a.Game=require("mduel/game");var c=a.Keyboard.getKeyName(b.keyCode);if(c&&a.Game.state=="game")for(var d=0,e=a.Keyboard.playerKeys.length;d<e;d++)if(a.Keyboard.playerKeys[d][c]){var f=a.Keyboard.playerKeys[d][c],g=(new Date).valueOf();a.Keyboard.playerKeyStates[d][f].pressed=!0,a.Keyboard.playerKeyStates[d][f].eventTime=g,a.Keyboard.playerKeyStates[d].lastKey.name=f,a.Keyboard.playerKeyStates[d].lastKey.pressed=!0,a.Keyboard.playerKeyStates[d].lastKey.eventTime=g,a.Game.localPlayers.length>d&&a.Game.localPlayers[d].keyDown&&a.Game.localPlayers[d].keyDown(a.Keyboard.playerKeyStates[d])}},a.Keyboard.keyUp=function(b){a.Game=require("mduel/game");var c=a.Keyboard.getKeyName(b.keyCode);if(c&&a.Game.state=="game")for(var d=0,e=a.Keyboard.playerKeys.length;d<e;d++)if(a.Keyboard.playerKeys[d][c]){var f=a.Keyboard.playerKeys[d][c],g=(new Date).valueOf();a.Keyboard.playerKeyStates[d][f].pressed=!1,a.Keyboard.playerKeyStates[d][f].eventTime=g,a.Keyboard.playerKeyStates[d].lastKey.name=f,a.Keyboard.playerKeyStates[d].lastKey.pressed=!1,a.Keyboard.playerKeyStates[d].lastKey.eventTime=g,a.Game.localPlayers.length>d&&a.Game.localPlayers[d].keyUp&&a.Game.localPlayers[d].keyUp(a.Keyboard.playerKeyStates[d])}},a.Keyboard.playerKeys=[{left:"left",right:"right",up:"up",down:"down",enter:"action"},{a:"left",d:"right",w:"up",s:"down",q:"action"}],a.Keyboard.playerKeyStates=[{lastKey:{name:undefined,pressed:!1,eventTime:0},up:{pressed:!1,eventTime:0},down:{pressed:!1,eventTime:0},left:{pressed:!1,eventTime:0},right:{pressed:!1,eventTime:0},action:{pressed:!1,eventTime:0}},{lastKey:{name:undefined,pressed:!1,eventTime:0},up:{pressed:!1,eventTime:0},down:{pressed:!1,eventTime:0},left:{pressed:!1,eventTime:0},right:{pressed:!1,eventTime:0},action:{pressed:!1,eventTime:0}}],a.Keyboard.keyNames={37:"left",38:"up",39:"right",40:"down",65:"a",83:"s",68:"d",87:"w",13:"enter",73:"i",74:"j",75:"k",76:"l",85:"u",81:"q"},a.Keyboard.getKeyName=function(b){var c=null;return a.Keyboard.keyNames[""+b]&&(c=a.Keyboard.keyNames[""+b]),c},a.Keyboard};typeof define!="undefined"?define("mduel/keyboard",[],k):typeof module!="undefined"&&(module.exports=k());var l=function(a,b){console.log("playerState loaded");if(typeof c=="undefined")var c={};return typeof c.PlayerState=="undefined"&&(c.PlayerState={}),c.Animations=a,c.Keyboard=b,c.PlayerState.playerState=function(a){var b={};return b.player=a.player,b.states={stand:{animation:"stand",keyUp:function(a){},keyDown:function(a){if(a.lastKey.name=="left"&&a.left.pressed&&!a.right.pressed)b.player.setVelocityX(-b.player.constants.runSpeed),b.player.setFlip(!0),b.setState("run");else if(a.lastKey.name=="right"&&a.right.pressed&&!a.left.pressed)b.player.setVelocityX(b.player.constants.runSpeed),b.player.setFlip(!1),b.setState("run");else if(a.lastKey.name=="down"&&!a.right.pressed&&!a.right.pressed){var c=b.player.isOnRope();c?(b.player.setPositionX(c.ropeStart.x-32),b.player.setVelocityY(b.player.constants.climbSpeed),b.setState("climbing")):b.setState("crouching")}else if(a.lastKey.name=="up"&&!a.right.pressed&&!a.right.pressed){var c=b.player.isOnRope();c?(b.player.setPositionX(c.ropeStart.x-32),b.player.setVelocityY(-b.player.constants.climbSpeed),b.setState("climbing")):(b.player.setVelocityY(-10),b.setState("standJump"))}}},run:{animation:"run",update:function(a){b.player.isOnPlatform()||b.setState("fall")},keyUp:function(a){!a.left.pressed&&!a.right.pressed?(b.player.setVelocityX(0),b.setState("stand")):!a.left.pressed&&a.right.pressed?(b.player.setVelocityX(b.player.constants.runSpeed),b.player.setFlip(!1)):a.left.pressed&&!a.right.pressed&&(b.player.setVelocityX(-b.player.constants.runSpeed),b.player.setFlip(!0))},keyDown:function(a){a.lastKey.name=="down"?a.left.pressed||a.right.pressed?b.setState("roll"):b.setState("crouch"):a.lastKey.name=="up"&&(b.player.setVelocityY(-10),b.setState("runJump"))}},standJump:{animation:"standJump",update:function(a){b.player.getVelocityY()<b.player.constants.maxFallSpeed&&b.player.changeVelocityY(1);if(b.player.getVelocityY()>=0){var c=b.player.isOnPlatform();c&&(b.player.setPositionY(c.y-56),b.player.setVelocityY(0),b.setState("stand"))}}},runJump:{animation:"runJump",update:function(a){b.player.getVelocityY()<b.player.constants.maxFallSpeed&&b.player.changeVelocityY(1);if(b.player.getVelocityY()>=0){var d=b.player.isOnPlatform();if(b.player.getPosition().y>=320)b.player.setVelocity(0,0),b.player.setPositionY(320),b.setState("disintegrate");else if(d){b.player.setVelocityY(0),b.player.setPositionY(d.y-56);var e=c.Keyboard.playerKeyStates[b.player.id];if(!e.right.pressed&&!e.left.pressed)b.player.setVelocityX(0),b.setState("stand");else{if(e.right.pressed&&!e.left.pressed&&b.player.getVelocityX()<0||e.left.pressed&&!e.right.pressed&&b.player.getVelocityX()>0)b.player.setFlip(!b.player.getFlip()),b.player.setVelocityX(-1*b.player.getVelocityX());b.setState("run")}}}}},crouching:{animation:"crouching",update:function(a){if(b.currentAnimation.isFinished()){var d=c.Keyboard.playerKeyStates[b.player.id];d.down.pressed?b.setState("crouch"):b.setState("uncrouching")}}},crouch:{animation:"crouch",keyUp:function(a){a.down.pressed||b.setState("uncrouching")}},roll:{animation:"roll",update:function(a){if(!b.player.isOnPlatform())b.setState("fall");else if(b.currentAnimation.isFinished()){b.player.setVelocityX(0);var d=c.Keyboard.playerKeyStates[b.player.id];d.down.pressed?b.setState("crouch"):b.setState("uncrouching")}}},knockForward:{animation:"knockForward",update:function(a){b.currentAnimation.isFinished()&&b.setState("fall")}},knockBack:{animation:"knockBack",update:function(a){b.currentAnimation.isFinished()&&b.setState("fall")}},uncrouching:{animation:"uncrouching",update:function(a){if(b.currentAnimation.isFinished()){var d=c.Keyboard.playerKeyStates[b.player.id];d.left.pressed&&(!d.right.pressed||d.left.eventTime>d.right.eventTime)?(b.player.setFlip(!0),b.player.setVelocityX(-b.player.constants.runSpeed),b.setState("run")):d.right.pressed&&(!d.left.pressed||d.right.eventTime>d.left.eventTime)?(b.player.setFlip(!1),b.player.setVelocityX(b.player.constants.runSpeed),b.setState("run")):b.setState("stand")}}},climbing:{animation:"climbing",update:function(a){var c=b.player.isOnRope();c||b.player.changePositionY(-b.player.getVelocityY())},keyUp:function(a){!a.up.pressed&&!a.down.pressed&&(b.player.setVelocityY(0),b.setState("rope"))},keyDown:function(a){a.lastKey.name=="left"?(b.player.setVelocityX(-b.player.constants.runSpeed),b.setState("fall")):a.lastKey.name=="right"&&(b.player.setVelocityX(b.player.constants.runSpeed),b.setState("fall"))}},rope:{animation:"rope",keyUp:function(a){},keyDown:function(a){a.lastKey.name=="up"?(b.player.setVelocityY(-b.player.constants.climbSpeed),b.setState("climbing")):a.lastKey.name=="down"?(b.player.setVelocityY(b.player.constants.climbSpeed),b.setState("climbing")):a.lastKey.name=="left"?(b.player.setVelocityX(-b.player.constants.runSpeed),b.setState("fall")):a.lastKey.name=="right"&&(b.player.setVelocityX(b.player.constants.runSpeed),b.setState("fall"))}},ropeFall:{animation:"stand",update:function(a){b.player.getVelocityY()<b.player.constants.maxFallSpeed&&b.player.changeVelocityY(1);if(b.player.getPositionY()>=320)b.player.setVelocity(0,0),b.player.setPositionY(320),b.setState("disintegrate");else{var c=b.player.isOnPlatform();c&&(b.player.setVelocity(0,0),b.setState("stand"))}}},fall:{animation:"standFall",update:function(a){b.player.getVelocityY()<b.player.constants.maxFallSpeed&&b.player.changeVelocityY(1);if(b.player.getPositionY()>=320)b.player.setVelocity(0,0),b.player.setPositionY(320),b.setState("disintegrate");else{var c=b.player.isOnPlatform();c&&(b.player.setVelocityY(0),b.player.setPositionY(c.y-56),b.setState("runJump")),b.player.getVelocityX()<0?b.player.setFlip(!0):b.player.getVelocityX()>0&&b.player.setFlip(!1)}}},disintegrate:{animation:"disintegrate",update:function(a){b.currentAnimation.isFinished()&&(b.setState("dead"),b.player.remove())}},dead:{animation:"empty"}},a.ref.child("state").on("value",function(a){var d=a.val();b.states[d]&&(b.currentState=b.states[d],b.currentAnimation=c.Animations[b.currentState.animation]())}),b.setState=function(a){b.player.setState(a)},b.update=function(a){b.currentState&&b.currentState.update&&b.currentState.update(a)},b},c.PlayerState};typeof define!="undefined"?define("mduel/playerState",["mduel/animations","mduel/keyboard"],l):typeof module!="undefined."&&(module.exports=l(require("./animations"),require("./keyboard")));var m=function(a,b,c,d){console.log("player loaded");if(typeof e=="undefined")var e={};return typeof e.Player=="undefined"&&(e.Player={}),e.Images=a,e.PlayerState=b,e.Stage=c,e.Util=d,e.Player.player=function(a){var b={};b.location="platform",b.firebase=a.firebase,b.playerState=e.PlayerState.playerState({player:b,ref:b.firebase}),b.id=a.id,b.spriteImage=a.spriteImage,b.constants=e.Player.Constants;var c=function(a,b){var c={};return function(){var d=b.apply(this,arguments);return hasOwnProperty.call(c,d)?c[d]:c[d]=a.apply(this,arguments)}},d=c(function(a,b,c,d,e,f){var g=e,h=f,i=0,j=0,k=document.createElement("canvas");k.height=a.height,k.width=a.width;var l=k.getContext("2d");l.drawImage(a,c,d,e,f,0,0,e,f);var m=l.getImageData(0,0,a.width,a.height);for(var c=0;c<m.width;c++)for(var d=0;d<m.height;d++){var n=(c+d*m.width)*4;m.data[n+3]&&(c<g&&(g=c),d<h&&(h=d),c>i&&(i=c),d>j&&(j=d))}return b?{x:e-g-(i-g),y:h,width:i-g,height:j-h}:{x:g,y:h,width:i-g,height:j-h}},function(a,b,c,d,e,f){return""+a+b+c+d+e+f});return b.setBoundingBox=function(){var a=b.get("position"),c=b.spriteImage,e=b.get("flip"),f=b.playerState.currentAnimation.getSprite(),g=d(c,e,f.x,f.y,f.width,f.height);b.set("box",{x:a.x+g.x,y:a.y+g.y,width:g.width,height:g.height})},b.getBoundingBox=function(){return b.get("box")},b.name=function(){return b.firebase.name()},b.remove=function(){b.firebase.remove()},b.get=function(a){var c;b.firebase.child(a).once("value",function(a){c=a.val()});if(typeof c=="undefined")throw"tried to get key "+a+" before waiting for the value to be available on firebase";return c},b.set=function(a,c){var d;b.firebase.once("value",function(a){d=a.val()}),b.firebase.transaction(function(b){var d=a.split("/"),e=b;for(var f=0;f<d.length-1;f++)e=e[d[f]];return e[d[d.length-1]]=c,b},function(a,b,c){a||console.log("set transaction failure",b.val(),c)})},b.change=function(a,c){var d;b.firebase.once("value",function(a){d=a.val()}),b.firebase.transaction(function(b){var d=a.split("/"),e=b;for(var f=0;f<d.length-1;f++)e=e[d[f]];return e[d[d.length-1]]+=c,b},function(a,b,c){a||console.log("change transaction failure",b.val(),c)})},b.setState=function(a){b.set("state",a)},b.getVelocity=function(){return b.get("velocity")},b.getVelocityX=function(){return b.get("velocity/x")},b.getVelocityY=function(){return b.get("velocity/y")},b.setVelocity=function(a,c){b.set("velocity/x",a),b.set("velocity/y",c)},b.setVelocityX=function(a){b.set("velocity/x",a)},b.setVelocityY=function(a){b.set("velocity/y",a)},b.changeVelocity=function(a,c){b.change("velocity/x",a),b.change("velocity/y",c)},b.changeVelocityX=function(a){b.change("velocity/x",a)},b.changeVelocityY=function(a){b.change("velocity/y",a)},b.getPosition=function(){return b.get("position")},b.setPosition=function(a,c){b.set("position/x",a),b.set("position/y",c)},b.getPositionX=function(){return b.get("position/x")},b.getPositionY=function(){return b.get("position/y")},b.setPositionX=function(a){b.set("position/x",a)},b.setPositionY=function(a){b.set("position/y",a)},b.getFlip=function(){return b.get("flip")},b.setFlip=function(a){b.set("flip",a)},b.changePosition=function(a,c){b.change("position/x",a),b.change("position/y",c)},b.changePositionX=function(a){b.change("position/x",a)},b.changePositionY=function(a){b.change("position/y",a)},b.draw=function(a,c){var d=b.get("position");if(!d)return;var e={x:d.x,y:d.y};b.playerState.currentAnimation.animate(c);var f=b.playerState.currentAnimation.getSprite();b.get("flip")&&(a.save(),e.x=-e.x-f.width,a.transform(-1,0,0,1,0,0)),a.drawImage(b.spriteImage,f.x,f.y,f.width,f.height,e.x,e.y,f.width,f.height),b.get("flip")&&a.restore(),b.setBoundingBox()},b.update=function(a){var c=b.get("position");if(!c)return;var d=b.getVelocityX(),e=b.getVelocityY();d!==0&&b.changePositionX(d),e!==0&&b.changePositionY(e),b.updateLocation(),b.playerState.update(a)},b.keyUp=function(a){b.playerState.currentState.keyUp&&b.playerState.currentState.keyUp(a)},b.keyDown=function(a){b.playerState.currentState.keyDown&&b.playerState.currentState.keyDown(a)},b.updateLocation=function(){b.location=="platform"&&(b.isOnPlatform()||(b.location="air"))},b.isOnPlatform=function(){e.Game=require("mduel/game");var a=undefined,c=b.get("position").x+32,d=function(a){return c>=a.x&&c<=a.x+32},f=e.Util.where(e.Game.stage.platforms,d),g=b.get("position").y+56,h=function(a){var b=a.y-g;return b<=12&&b>=-8},i=e.Util.where(f,h);return i.length>0&&(a=i[0]),a},b.isOnRope=function(){e.Game=require("mduel/game");var a=undefined,c=b.get("position").x+32,d=function(a){return c>=a.ropeStart.x-4&&c<=a.ropeStart.x+4},f=e.Util.where(e.Game.stage.ropes,d);return f.length==1&&f[0].ropeEnd.y>=b.get("position").y+56&&f[0].ropeStart.y<=b.get("position").y+14&&(a=f[0]),a},b},e.Player.initializeLocalPlayer=function(a){return e.Player.player({spriteImage:e.Images.player1,firebase:a,id:0})},e.Player.Constants={runSpeed:3.2,climbSpeed:2.5,maxFallSpeed:12},e.Player};typeof define!="undefined"?define("mduel/player",["mduel/images","mduel/playerState","mduel/stage","mduel/util"],m):typeof module!="undefined."&&(module.exports=m(require("./images"),require("./playerState"),require("./stage"),require("./util"))),function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=e.toString,k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){if(a instanceof x)return a;if(!(this instanceof x))return new x(a);this._wrapped=a};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.4.3";var y=x.each=x.forEach=function(a,b,d){if(a==null)return;if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;e<f;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g in a)if(x.has(a,g)&&b.call(d,a[g],g,a)===c)return};x.map=x.collect=function(a,b,c){var d=[];return a==null?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),d)};var z="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;a==null&&(a=[]);if(n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)});if(!e)throw new TypeError(z);return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;a==null&&(a=[]);if(o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=x.keys(a);f=g.length}y(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)});if(!e)throw new TypeError(z);return c},x.find=x.detect=function(a,b,c){var d;return A(a,function(a,e,f){if(b.call(c,a,e,f))return d=a,!0}),d},x.filter=x.select=function(a,b,c){var d=[];return a==null?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},x.reject=function(a,b,c){return x.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return a==null?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){if(!(e=e&&b.call(d,a,f,g)))return c}),!!e)};var A=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return a==null?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){if(e||(e=b.call(d,a,f,g)))return c}),!!e)};x.contains=x.include=function(a,b){return a==null?!1:s&&a.indexOf===s?a.indexOf(b)!=-1:A(a,function(a){return a===b})},x.invoke=function(a,b){var c=h.call(arguments,2);return x.map(a,function(a){return(x.isFunction(b)?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,function(a){return a[b]})},x.where=function(a,b){return x.isEmpty(b)?[]:x.filter(a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);if(!b&&x.isEmpty(a))return-Infinity;var d={computed:-Infinity,value:-Infinity};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);if(!b&&x.isEmpty(a))return Infinity;var d={computed:Infinity,value:Infinity};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=x.random(c++),d[c-1]=d[b],d[b]=a}),d};var B=function(a){return x.isFunction(a)?a:function(b){return b[a]}};x.sortBy=function(a,b,c){var d=B(b);return x.pluck(x.map(a,function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||c===void 0)return 1;if(c<d||d===void 0)return-1}return a.index<b.index?-1:1}),"value")};var C=function(a,b,c,d){var e={},f=B(b||x.identity);return y(a,function(b,g){var h=f.call(c,b,g,a);d(e,h,b)}),e};x.groupBy=function(a,b,c){return C(a,b,c,function(a,b,c){(x.has(a,b)?a[b]:a[b]=[]).push(c)})},x.countBy=function(a,b,c){return C(a,b,c,function(a,b){x.has(a,b)||(a[b]=0),a[b]++})},x.sortedIndex=function(a,b,c,d){c=c==null?x.identity:B(c);var e=c.call(d,b),f=0,g=a.length;while(f<g){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},x.toArray=function(a){return a?x.isArray(a)?h.call(a):a.length===+a.length?x.map(a,x.identity):x.values(a):[]},x.size=function(a){return a==null?0:a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return a==null?void 0:b!=null&&!c?h.call(a,0,b):a[0]},x.initial=function(a,b,c){return h.call(a,0,a.length-(b==null||c?1:b))},x.last=function(a,b,c){return a==null?void 0:b!=null&&!c?h.call(a,Math.max(a.length-b,0)):a[a.length-1]},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,b==null||c?1:b)},x.compact=function(a){return x.filter(a,x.identity)};var D=function(a,b,c){return y(a,function(a){x.isArray(a)?b?g.apply(c,a):D(a,b,c):c.push(a)}),c};x.flatten=function(a,b){return D(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.uniq=x.unique=function(a,b,c,d){x.isFunction(b)&&(d=c,c=b,b=!1);var e=c?x.map(a,c,d):a,f=[],g=[];return y(e,function(c,d){if(b?!d||g[g.length-1]!==c:!x.contains(g,c))g.push(c),f.push(a[d])}),f},x.union=function(){return x.uniq(i.apply(d,arguments))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.indexOf(b,a)>=0})})},x.difference=function(a){var b=i.apply(d,h.call(arguments,1));return x.filter(a,function(a){return!x.contains(b,a)})},x.zip=function(){var a=h.call(arguments),b=x.max(x.pluck(a,"length")),c=new Array(b);for(var d=0;d<b;d++)c[d]=x.pluck(a,""+d);return c},x.object=function(a,b){if(a==null)return{};var c={};for(var d=0,e=a.length;d<e;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(a==null)return-1;var d=0,e=a.length;if(c){if(typeof c!="number")return d=x.sortedIndex(a,b),a[d]===b?d:-1;d=c<0?Math.max(0,e+c):c}if(s&&a.indexOf===s)return a.indexOf(b,c);for(;d<e;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b,c){if(a==null)return-1;var d=c!=null;if(t&&a.lastIndexOf===t)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);var e=d?c:a.length;while(e--)if(a[e]===b)return e;return-1},x.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);while(e<d)f[e++]=a,a+=c;return f};var E=function(){};x.bind=function(a,b){var c,d;if(a.bind===w&&w)return w.apply(a,h.call(arguments,1));if(!x.isFunction(a))throw new TypeError;return c=h.call(arguments,2),d=function(){if(this instanceof d){E.prototype=a.prototype;var e=new E;E.prototype=null;var f=a.apply(e,c.concat(h.call(arguments)));return Object(f)===f?f:e}return a.apply(b,c.concat(h.call(arguments)))}},x.bindAll=function(a){var b=h.call(arguments,1);return b.length==0&&(b=x.functions(a)),y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b){var c,d,e,f,g=0,h=function(){g=new Date,e=null,f=a.apply(c,d)};return function(){var i=new Date,j=b-(i-g);return c=this,d=arguments,j<=0?(clearTimeout(e),e=null,g=i,f=a.apply(c,d)):e||(e=setTimeout(h,j)),f}},x.debounce=function(a,b,c){var d,e;return function(){var f=this,g=arguments,h=function(){d=null,c||(e=a.apply(f,g))},i=c&&!d;return clearTimeout(d),d=setTimeout(h,b),i&&(e=a.apply(f,g)),e}},x.once=function(a){var b=!1,c;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}},x.wrap=function(a,b){return function(){var c=[a];return g.apply(c,arguments),b.apply(this,c)}},x.compose=function(){var a=arguments;return function(){var b=arguments;for(var c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return a<=0?b():function(){if(--a<1)return b.apply(this,arguments)}},x.keys=v||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)x.has(a,c)&&(b[b.length]=c);return b},x.values=function(a){var b=[];for(var c in a)x.has(a,c)&&b.push(a[c]);return b},x.pairs=function(a){var b=[];for(var c in a)x.has(a,c)&&b.push([c,a[c]]);return b},x.invert=function(a){var b={};for(var c in a)x.has(a,c)&&(b[a[c]]=c);return b},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)x.contains(c,e)||(b[e]=a[e]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]==null&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var F=function(a,b,c,d){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return!1;var f=c.length;while(f--)if(c[f]==a)return d[f]==b;c.push(a),d.push(b);var g=0,h=!0;if(e=="[object Array]"){g=a.length,h=g==b.length;if(h)while(g--)if(!(h=F(a[g],b[g],c,d)))break}else{var i=a.constructor,k=b.constructor;if(i!==k&&!(x.isFunction(i)&&i instanceof i&&x.isFunction(k)&&k instanceof k))return!1;for(var l in a)if(x.has(a,l)){g++;if(!(h=x.has(b,l)&&F(a[l],b[l],c,d)))break}if(h){for(l in b)if(x.has(b,l)&&!(g--))break;h=!g}}return c.pop(),d.pop(),h};x.isEqual=function(a,b){return F(a,b,[],[])},x.isEmpty=function(a){if(a==null)return!0;if(x.isArray(a)||x.isString(a))return a.length===0;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!!a&&a.nodeType===1},x.isArray=u||function(a){return j.call(a)=="[object Array]"},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!!a&&!!x.has(a,"callee")}),typeof /./!="function"&&(x.isFunction=function(a){return typeof a=="function"}),x.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},x.isNaN=function(a){return x.isNumber(a)&&a!=+a},x.isBoolean=function(a){return a===!0||a===!1||j.call(a)=="[object Boolean]"},x.isNull=function(a){return a===null},x.isUndefined=function(a){return a===void 0},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.times=function(a,b,c){var d=Array(a);for(var e=0;e<a;e++)d[e]=b.call(c,e);return d},x.random=function(a,b){return b==null&&(b=a,a=0),a+(0|Math.random()*(b-a+1))};var G={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};G.unescape=x.invert(G.escape);var H={escape:new RegExp("["+x.keys(G.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(G.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return b==null?"":(""+b).replace(H[a],function(b){return G[a][b]})}}),x.result=function(a,b){if(a==null)return null;var c=a[b];return x.isFunction(c)?c.call(a):c},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),M.call(this,c.apply(x,a))}})};var I=0;x.uniqueId=function(a){var b=""+ ++I;return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var J=/(.)^/,K={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(a,b,c){c=x.defaults({},c,x.templateSettings);var d=new RegExp([(c.escape||J).source,(c.interpolate||J).source,(c.evaluate||J).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){return f+=a.slice(e,h).replace(L,function(a){return"\\"+K[a]}),c&&(f+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(f+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),g&&(f+="';\n"+g+"\n__p+='"),e=h+b.length,b}),f+="';\n",c.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(c.variable||"obj","_",f)}catch(h){throw h.source=f,h}if(b)return g(b,x);var i=function(a){return g.call(this,a,x)};return i.source="function("+(c.variable||"obj")+"){\n"+f+"}",i},x.chain=function(a){return x(a).chain()};var M=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),(a=="shift"||a=="splice")&&c.length===0&&delete c[0],M.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return M.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),define("components/underscore/underscore",function(a){return function(){return a._}}(this));var n=function(a,b,c,d){console.log("pickups loaded");if(typeof e=="undefined")var e={};return typeof e.Pickups=="undefined"&&(e.Pickups={}),e.Animations=a,e.Images=b,e.Util=c,e.Pickups.pickup=function(a){var b={};return b.firebase=a,b.bubble=e.Animations.bubble(),b.image=e.Animations.skull(),b.remove=function(){a.remove()},b.get=function(b){var c=null;return a.child(b).once("value",function(a){c=a.val()}),c},b.set=function(b,c){var d;a.once("value",function(a){d=a.val()}),a.transaction(function(a){var d=b.split("/"),e=a;for(var f=0;f<d.length-1;f++)e=e[d[f]];return e[d[d.length-1]]=c,a},function(a,b,c){a||console.log("set transaction failure",b.val(),c)})},b.change=function(b,c){var d;a.once("value",function(a){d=a.val()}),a.transaction(function(a){var d=b.split("/"),e=a;for(var f=0;f<d.length-1;f++)e=e[d[f]];return e[d[d.length-1]]+=c,a},function(a,b,c){a||console.log("change transaction failure",b.val(),c)})},b.update=function(a){var c=b.get("velocity");b.change("position/x",c.x),b.change("position/y",c.y);var d=b.get("position");d.x<0?b.set("velocity/x",Math.abs(c.x)):d.x>610&&b.set("velocity/x",-Math.abs(c.x)),d.y<0?b.set("velocity/y",Math.abs(c.y)):d.y>340&&b.set("velocity/y",-Math.abs(c.y))},b.drawAnimation=function(a,b,c,d){c.animate(b);var f=c.getSprite();a.drawImage(e.Images.pickups,f.x,f.y,f.width,f.height,d.x,d.y,f.width,f.height)},b.draw=function(a,c){var d=b.get("position");if(!d)return;b.drawAnimation(a,c,b.bubble,d),b.drawAnimation(a,c,b.image,d)},b},e.Pickups.pickups=function(a){var b={};b.firebase=a,b.items=[];var c=function(a){console.log("onPickupAdded",a.val()),b.items.push(new e.Pickups.pickup(a.ref()))},d=function(a){console.log("onPickupRemoved",a.val()),delete b.items[a.name()]};return a.on("child_added",c),a.on("child_removed",d),b.update=function(a){for(var c=0;c<b.items.length;c++)b.items[c].update(a)},b.draw=function(a,c){for(var d=0;d<b.items.length;d++)b.items[d].draw(a,c)},b.handlePlayerCollisions=function(a){for(var c=0;c<b.items.length;c++){var d=b.items[c],f=d.getBoundingBox();for(var g=0;g<a.length;g++){var h=a[g],i=h.getBoundingBox();if(e.Util.colliding(f,i)){h.set("pickup",d.get("type")),d.remove();break}}}},b.create=function(){var b=Math.random()+.8,c=3.6-b;b=Math.random()<.5?b:-b,c=Math.random()<.5?c:-c,a.push({position:{x:304,y:20},velocity:{x:b,y:c},type:"explode"})},b},e.Pickups};typeof define!="undefined"?define("mduel/pickups",["mduel/animations","mduel/images","mduel/util","components/underscore/underscore"],n):typeof module!="undefined"&&(module.exports=n(require("../mduel/animations"),require("../mduel/images"),require("../mduel/util"),require("../components/underscore/underscore")));var o=function(a,b,c,d,e,f,g){console.log("game loaded");if(typeof h=="undefined")var h={};return typeof h.Game=="undefined"&&(h.Game={}),h.Player=b,h.Images=c,h.Pickups=d,h.Stage=a,h.Keyboard=e,h.Util=f,h.Game.startGame=function(a){h.Game.debug=!1,h.Game.framerate=30,h.Game.lastFrameDrawn=(new Date).valueOf(),h.Game.state="game",h.Game.localPlayers=[],h.Game.remotePlayers=[],h.Game.pickups=h.Pickups.pickups(a.child("pickups")),h.Game.stage=h.Stage.stage(),h.Game.addLocalPlayer(a),a.child("players").on("child_added",function(a,b){var c=!1;for(var d=0,e=h.Game.localPlayers.length;d<e;d++)c=c||h.Game.localPlayers[d].name()===a.name();if(!c){var f=h.Player.player({spriteImage:h.Images.player2,firebase:a.ref(),id:0});h.Game.remotePlayers.push(f)}}),a.child("players").on("child_removed",function(a){for(var b=0,c=h.Game.localPlayers.length;b<c;b++)if(h.Game.localPlayers[b].name()===a.name()){h.Game.localPlayers.splice(b,1);break}for(var b=0,c=h.Game.remotePlayers.length;b<c;b++)if(h.Game.remotePlayers[b].name()===a.name()){h.Game.remotePlayers.splice(b,1);break}}),window.onkeydown=h.Keyboard.keyDown,window.onkeyup=h.Keyboard.keyUp,setInterval(h.Game.gameLoop,1e3/h.Game.framerate)},h.Game.generateStartPosition=function(){var a=h.Game.stage.platforms,b=Math.floor(Math.random()*(new Date).getTime()),c=a[b%a.length];return{x:c.x-16,y:c.y-56}},h.Game.addLocalPlayer=function(a){var b={position:h.Game.generateStartPosition(),velocity:{x:0,y:0},box:{x:0,y:0,width:0,height:0},flip:!1,state:"stand"},c=a.child("players").push(b);c.removeOnDisconnect();var d;d=function(a){if(g.isEqual(a.val(),b)){c.off("value",d);var e=h.Player.initializeLocalPlayer(c);h.Game.localPlayers.push(e)}},c.on("value",d)},h.Game.gameLoop=function(){var a=(new Date).valueOf(),b=a-h.Game.lastFrameDrawn;h.Game.lastFrameDrawn=a,h.Game.handleCollisions(b),h.Game.update(b),h.Game.draw(b)},h.Game.update=function(a){h.Game.stage.update(a);for(var b=0,c=h.Game.localPlayers.length;b<c;b++)h.Game.localPlayers[b].update(a)},h.Game.draw=function(a){var b=document.getElementById("game"),c=b.getContext("2d");c.clearRect(0,0,b.width,b.height);if(h.Game.state=="game"){h.Game.stage.draw(c,a,b.width,b.height);for(var d=0,e=h.Game.remotePlayers.length;d<e;d++){var f=h.Game.remotePlayers[d];f.draw(c,a)}for(var d=0,e=h.Game.localPlayers.length;d<e;d++){var f=h.Game.localPlayers[d];f.draw(c,a)}h.Game.pickups.draw(c,a)}if(h.Game.debug){var g=function(a){var b=a.getBoundingBox();c.strokeStyle="red",c.strokeRect(b.x,b.y,b.width,b.height)};for(var d=0,e=h.Game.remotePlayers.length;d<e;d++)g(h.Game.remotePlayers[d]);for(var d=0,e=h.Game.localPlayers.length;d<e;d++)g(h.Game.localPlayers[d]);c.fillStyle="#f00",c.font="arial 30px sans-serif",c.fillText(h.Game.debugText||"",5,10)}},h.Game.handleWallCollisions=function(a,b){var c=document.getElementById("game"),d=b.get("position");if(!d)return;var e=b.getBoundingBox(),f={x:-100,y:0,width:100,height:c.height},g={x:c.width,y:0,width:100,height:c.height};if(h.Util.colliding(f,e)){if(b.getVelocityX()>0)return;b.setFlip(!b.getFlip()),b.setVelocityX(-1*b.getVelocityX())}else if(h.Util.colliding(g,e)){if(b.getVelocityX()<0)return;b.setFlip(!b.getFlip()),b.setVelocityX(-1*b.getVelocityX())}},h.Game.handlePlayerCollisions=function(a,b,c){if(b.name()===c.name())return;if(!h.Util.colliding(b.getBoundingBox(),c.getBoundingBox()))return;console.log("collision")},h.Game.handleCollisions=function(a){for(var b=0;b<h.Game.localPlayers.length;b++){var c=h.Game.localPlayers[b];h.Game.handleWallCollisions(a,c);for(var d=b+1;d<h.Game.localPlayers.length;d++){var e=h.Game.localPlayers[d];h.Game.handlePlayerCollisions(a,c,e)}for(var d=0;d<h.Game.remotePlayers.length;d++){var e=h.Game.remotePlayers[d];h.Game.handlePlayerCollisions(a,c,e)}}},h.Game};typeof define!="undefined"?define("mduel/game",["mduel/stage","mduel/player","mduel/images","mduel/pickups","mduel/keyboard","mduel/util","components/underscore/underscore"],o):typeof module!="undefined"&&(module.exports=o(require("./stage"),require("./player"),require("./images"),require("./pickups"),require("./keyboard"),require("./util"),require("../components/underscore/underscore"))),require.config({shim:{"components/underscore/underscore":{exports:"_"},"vendor/firebase":{exports:"Firebase"}},paths:{jquery:"vendor/jquery.min"}}),require(["mduel/game"],function(a){var b=new Firebase("https://mduel.firebaseio.com/game/");a.startGame(b)}),define("main",function(){})}();